appId: com.hippogriff.remo
---
# Annotation-based iteration: place a circle, type instruction, submit
# Prerequisite: must be on IterationScreen (run after design selection)
- launchApp:
    clearState: true
    arguments:
      maestro-test: "true"
    permissions:
      photos: allow
      camera: allow
# Create project and navigate through to iteration
- tapOn:
    id: "home_new_project"
- assertVisible: "Scan room dimensions"
- tapOn:
    id: "home_project_0"
- assertVisible: "Scan Your Room"
- tapOn:
    id: "scan_skip"
- tapOn: "Skip"
- assertVisible: "Design Chat"
- tapOn:
    id: "mode_skip"
- tapOn: "Skip"
- assertVisible: "Choose a Design"
- tapOn: "Modern Minimalist"
- tapOn:
    id: "selection_choose"
# Now on IterationScreen â€” default mode is "Mark Areas"
- assertVisible: "Refine Design"
- assertVisible: "Mark Areas"
- assertVisible: "Round 1 of 5"
- takeScreenshot: 11-annotation-before
# Tap the canvas to place an annotation circle (center of the image area)
- tapOn:
    point: "50%,35%"
# Bottom sheet auto-opens with the new region (may be collapsed)
- assertVisible: "Edit Regions"
# Expand the region row if collapsed
- tapOn: "Tap to add instruction"
# Wait for expansion animation
- extendedWaitUntil:
    visible: "Action"
    timeout: 3000
# Type instruction for the circle (min 10 chars)
- tapOn: "Instruction \\(min 10 chars\\)"
- inputText: "Replace this lamp with a modern floor lamp design"
# Dismiss keyboard before tapping avoid field
- hideKeyboard
# Type avoid keywords (P3-01)
- tapOn: "Avoid \\(comma-separated\\)"
- inputText: "dark colors, heavy furniture"
# Dismiss keyboard before tapping nudge chip
- hideKeyboard
# Toggle a style nudge chip (P3-01)
- tapOn: "more modern"
# Dismiss the edit panel
- tapOn: "Done"
# Submit should now be enabled
- tapOn:
    id: "iteration_submit"
# Wait for generation to complete
- extendedWaitUntil:
    visible: "Round 2 of 5"
    timeout: 5000
- takeScreenshot: 11-annotation-after
# Verify revision history is accessible (P3-04)
- tapOn: "History"
- assertVisible: "Revision History"
- assertVisible:
    id: "revision_image_1"
- tapOn: "Done"
